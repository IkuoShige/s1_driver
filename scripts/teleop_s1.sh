#!/bin/bash

# RoboMaster S1 Teleoperation Script
# ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§ãƒ­ãƒœãƒƒãƒˆã‚’é éš”æ“ä½œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

echo "=== RoboMaster S1 Teleoperation ==="
echo ""

# ROS2ç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
source /home/ikuo/s1_ws/install/setup.bash

echo "ðŸ¤– S1ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’èµ·å‹•ä¸­..."
ros2 run s1_driver s1_driver_node &
DRIVER_PID=$!

# ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã®åˆæœŸåŒ–ã‚’å¾…ã¤
echo "â³ ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã®åˆæœŸåŒ–ã‚’å¾…æ©Ÿä¸­..."
sleep 4

echo ""
echo "âœ… S1ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãŒæº–å‚™å®Œäº†ã—ã¾ã—ãŸï¼"
echo ""
echo "ðŸŽ® ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒ†ãƒ¬ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ðŸ“‹ æ“ä½œæ–¹æ³•:"
echo "   i    k    o       å‰é€²ãƒ»åœæ­¢ãƒ»å¾Œé€€"
echo "   j    ,    l       å·¦å›žè»¢ãƒ»åœæ­¢ãƒ»å³å›žè»¢"  
echo "   u         .       å·¦å‰ãƒ»å³å¾Œ"
echo "   m         /       å·¦å¾Œãƒ»å³å‰"
echo ""
echo "   q/z : é€Ÿåº¦å¢—æ¸›"
echo "   w/x : å›žè»¢é€Ÿåº¦å¢—æ¸›"
echo "   ã‚¹ãƒšãƒ¼ã‚¹: ç·Šæ€¥åœæ­¢"
echo "   Ctrl+C : çµ‚äº†"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰teleopã‚’é–‹å§‹
echo "ðŸŽ¯ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰åˆ¶å¾¡é–‹å§‹..."
trap 'echo ""; echo "ðŸ›‘ ãƒ†ãƒ¬ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†ä¸­..."; kill $DRIVER_PID 2>/dev/null; exit 0' INT

ros2 run teleop_twist_keyboard teleop_twist_keyboard --ros-args --remap cmd_vel:=/cmd_vel

# çµ‚äº†å‡¦ç†
echo ""
echo "ðŸ›‘ S1ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’åœæ­¢ä¸­..."
kill $DRIVER_PID 2>/dev/null || true
wait $DRIVER_PID 2>/dev/null || true

echo "âœ… ãƒ†ãƒ¬ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†"
